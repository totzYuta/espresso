\documentclass[11pt,a4j]{jarticle}
\oddsidemargin=-1.5cm
\textwidth=18cm
\footskip=1.5cm
\textheight 25cm
\topmargin -1.5cm

\usepackage{listings,jlisting}

\lstset{%
  language={C},
  basicstyle={\small},%
  identifierstyle={\small},%
  commentstyle={\small\itshape},%
  keywordstyle={\small\bfseries},%
  ndkeywordstyle={\small},%
  stringstyle={\small\ttfamily},
  frame={tb},
  breaklines=true,
  columns=[l]{fullflexible},%
  numbers=left,%
  xrightmargin=0zw,%
  xleftmargin=3zw,%
  numberstyle={\scriptsize},%
  stepnumber=1,
  numbersep=1zw,%
  lineskip=-0.5ex%
}


\title{情報工学実験コンパイラ レポート}
\author{氏名：佐藤佑太\\学生番号：09425566}
\date{出題日：平成27年4月13日\\提出日：平成27年7月28日\\提出期限：平成27年7月28日}
\begin{document}
\maketitle
\newpage


%%%%%%%%%%%%%%%%%
%   SECTION 1   %
%%%%%%%%%%%%%%%%%

\section{実験の目的}

\begin{enumerate}
\item {言語処理系がどのように実装されるのか学ぶ}
\item {大きなプログラムにおける関数の切り出しなどの設計・モジュール化}
\item {コンピュータにとって効率のよい計算方法、アルゴリズムの設計}
\end{enumerate}
これらのの三つ事柄について学習することが主な目的である．



%%%%%%%%%%%%%%%%%
%   SECTION 2   %
%%%%%%%%%%%%%%%%%

\section{言語の定義}

{\baselineskip 2mm
\begin{verbatim}
<プログラム> ::= <変数宣言部> <文集合>
<変数宣言部> ::= <宣言文> <変数宣言部> | <宣言文>
<宣言文> ::= define <識別子>;| define <配列宣言>;
<配列宣言>::= <識別子>[<整数>]|<配列宣言>[<整数>]
<文集合> ::=  <文> <文集合>| <文>
<文> ::= <代入文> | <配列代入文> | <ループ文> | <条件分岐文> | <関数宣言文> | <関数>;
<代入文> ::= <識別子> = <算術式>; | <識別子> = call <関数>; 
<配列代入文> ::= <配列> = <算術式>; | <配列> = call <関数>;
<算術式> ::= <算術式> <加減演算子> <項> | <項>
<項> ::= <項> <乗除演算子> <因子> | <因子>
<因子> ::= <変数> | (<算術式>)
<加減演算子> ::= + | -
<乗除演算子> ::= * | /
<変数> ::= <識別子> | <数> | <配列>
<引数> ::= <変数>,<引数> | <変数>
<関数> ::= <識別子>(<引数>) |　<識別子>()
<関数宣言文> ::= func <識別子>(<引数>) { <文集合> } | func <識別子>(){ <文集合> }
|func <識別子>(<引数>) {<文集合> return <変数>;}|func <識別子>(){<文集合> return <変数>;}
<ループ文> ::= while (<条件式>) { <文集合> }
<条件分岐文> ::= if (<条件式>) { <文集合> } | if (<条件式>) { <文集合> } else { <文集合> }
<条件式> ::= <算術式> <比較演算子> <算術式>
<比較演算子> ::= == | '<' | '>'| >= | <= | !=
<識別子> ::= <英字> <英数字列> | <英字>
<英数字列> ::= <英数字> <英数字列>| <英数字>
<英数字> ::= <英字> | <数字>
<数> ::= <数><数字> | <0以外>
<英字> ::= a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w
|x|y|z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z
<整数> ::= <数>|0
<数字> ::= 0|1|2|3|4|5|6|7|8|9
<0以外> ::= 1|2|3|4|5|6|7|8|9
<配列> ::= <識別子>[<変数>]|<配列>[<変数>]
\end{verbatim}}



%%%%%%%%%%%%%%%%%
%   SECTION 3   %
%%%%%%%%%%%%%%%%%

\section{定義した言語で受理されるプログラムの例}


以下が、定義した言語によって受理されるプログラムの例である。

\lstinputlisting{../sample-programs/sample1.esp}


プログラムは、変数宣言部、関数宣言部、実行部の3つに分かれて記述される。

\newpage



%%%%%%%%%%%%%%%%%
%   SECTION 4   %
%%%%%%%%%%%%%%%%%

\section{字句解析，演算子順位構文解析・再帰下降型構文解析のそれぞれの方法の概略}

\begin{enumerate}
\item{字句解析}
lex.cに定義されているnextToken()関数で主要部分となる字句解析の処理を行っている。

字句解析では、大まかに以下のような流れでプログラムをトークン列に分解している。

1. ファイルから次の1文字を読み込み、遷移表をもとに状態を遷移する
2. 状態を確認して終了状態なら3の処理へ、終了状態でなければ1を繰り返す
3. それまでに読み込んだ文字列と、得られた文字列に合致する型情報を格納する
3. そのトークンを返り値として関数を終了する

% (e.g. int \verb|=>| 予約語，sum \verb|=>| 識別子， etc..)


\item{演算子順位構文解析}
算術式を解析するために用いる方法．
下向き構文解析法であり，演算子順位行列を用いて構文木を作成する．

以下に演算子順位行列を示す．
\begin{table}[h]
\centering
\begin{tabular}{|c|c|c|c|c|c|}\hline
左＼右 & +,- & *,/ & ( & ) & \$\\ \hline
+,- & \verb|>| & \verb|<| & \verb|<| & \verb|>| & \verb|>| \\ \hline
*,/ & \verb|>| & \verb|>| & \verb|<| & \verb|>| & \verb|>| \\ \hline
( & \verb|<| & \verb|<| & \verb|<| & = & × \\ \hline
) & \verb|>| & \verb|>| & × & \verb|>| & \verb|>| \\ \hline
\$ & \verb|<| & \verb|<| & \verb|<| & × & 終了 \\ \hline
\end{tabular}
\end{table}


\item{再帰下降型構文解析}
算術式以外を解析するために用いる方法．
言語の定義をそのままプログラムに出来るのでわかりやすい．

\end{enumerate}


%%%%%%%%%%%%%%%%%
%   SECTION 5   %
%%%%%%%%%%%%%%%%%

\section{コード生成の概略}

\begin{enumerate}
\item {メモリの使い方}\\
  最終的に関数を実装することが出来なかったので，
すべてのデータはC言語に置けるグローバル変数と扱いは同等となっている．
\item {レジスタの使い方}
  \begin{itemize}
  \item \$t0 ～ \$t6~算術式の解析用
  \item \$t7~la，liなどのデータ読み込み用
  \item \$t8~条件式の判定用
  \item \$t9~代入文に置いて配列が代入先になったとき用
  \end{itemize}
\item {算術式のコード生成の方法}\\
  四つ組中間表現を用いている．
\item {特に工夫した点についての説明}\\
  数値または識別子をを一つだけ代入する場合は，
  直で\$v0に値が代入されるようになっている．
\end{enumerate}



%%%%%%%%%%%%%%%%%
%   SECTION 6   %
%%%%%%%%%%%%%%%%%

\section{コンパイラのソースプログラムのある場所}
http://jikken1.arc.cs.okayama-u.ac.jp/gitbucket/09425566/compiler

実行方法:\\
\hspace{24pt}./esp \verb|<|filename\verb|>|

\verb|<|filename\verb|>|:\\
\hspace{24pt} sum.esp, fact.esp\\


%%%%%%%%%%%%%%%%%
%   SECTION 7   %
%%%%%%%%%%%%%%%%%

\section{最終課題を解くために書いたプログラムの概要}

基本的な書き方はC言語に近い．
しかし，実装されていない機能が多く存在しているため，
書き方に制限がかけられている．
データの型はint型しか存在せず，関数は関数名の前にfunとつける必要がある．
配列の括弧の中には算術式が入るように再帰的に処理している．


%%%%%%%%%%%%%%%%%
%   SECTION 8   %
%%%%%%%%%%%%%%%%%

\section{最終課題の実行結果} %ステップ数も表記する．

\begin{enumerate}
\item {1 から 10 までの数の和 }
  \begin{itemize}
  \item
    プログラム：sum.esp
  \item
    実行結果：55~(0x10004004) %TODO
  \item
    ステップ数：360 instructions %TODO
  \end{itemize}
\item {階乗の計算}
  \begin{itemize}
  \item
    プログラム：fact.esp
  \item
    実行結果：120~(0x10004004) %TODO
  \item
    ステップ数：195 instructions %TODO
  \end{itemize}
\item {エラトステネスのふるい}
  関数のコード生成部分を作成できなかったため実現できなかった。
\item {行列積の計算}
  配列を扱う部分のコード生成処理を作成できなかったため実現できなかった。
\item {クイックソート}\\
  ローカル変数を作成出来なかったため，作成出来なかった．
\end{enumerate}


%%%%%%%%%%%%%%%%%
%   SECTION 8   %
%%%%%%%%%%%%%%%%%

\section{考察}


\end{document}
